#!/usr/bin/env python3

import rospy
from sensor_msgs.msg import PointCloud2
import sensor_msgs.point_cloud2 as pc2


def pointcloud_callback(msg):
    rospy.loginfo("Received PointCloud2 message")

    # Example: iterate over the first few points
    for i, point in enumerate(
        pc2.read_points(msg, field_names=("x", "y", "z"), skip_nans=True)
    ):
        x, y, z = point
        rospy.loginfo(f"Point {i}: x={x:.3f}, y={y:.3f}, z={z:.3f}")
        if i >= 4:  # just print a few points
            break


def main():
    rospy.init_node("pointcloud_subscriber", anonymous=True)

    rospy.Subscriber(
        "/sciurus17/camera/depth_registered/points",
        PointCloud2,
        pointcloud_callback,
        queue_size=1
    )

    rospy.loginfo("Subscribed to point cloud topic")
    rospy.spin()


if __name__ == "__main__":
    main()
